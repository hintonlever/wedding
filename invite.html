<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wedding Invitation | Alina & Ben</title>

    <!-- iOS/Safari compatibility -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Alina & Ben">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#fef9f6">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500&family=Roboto+Flex:wght@200;300;400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Debug overlay -->
    <div class="debug-overlay" id="debugOverlay">
        <div><span class="label">Version:</span> <span class="highlight" id="debugVersion">v0.2.0</span></div>
        <div><span class="label">Section:</span> <span id="debugSection">Section</span></div>
        <div><span class="label">Scroll:</span> <span id="debugScroll">0%</span></div>
        <div><span class="label">Viewport:</span> <span id="debugViewport">0x0</span></div>
        <div><span class="label">Container:</span> <span id="debugContainer">0x0</span></div>
    </div>

    <!-- Version badge (always visible) -->
    <div class="version-badge" id="versionBadge">v0.4.0</div>

    <!-- Main Navigation -->
    <nav class="main-nav" id="mainNav">
        <div class="nav-container">
            <!-- This the default section -->
            <a href="#rsvp" class="nav-logo">A <span>&</span> B</a>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
                <span></span>
            </button>
            <div class="nav-menu" id="navMenu">
                <a href="#rsvp" class="nav-link"><span class="nav-link-icon">&#128140;</span>RSVP</a>
                <a href="#getting-there" class="nav-link"><span class="nav-link-icon">&#9992;&#65039;</span>Getting There</a>
                <a href="#accommodation" class="nav-link"><span class="nav-link-icon">&#127968;</span>Accommodation</a>
                <a href="#faq" class="nav-link"><span class="nav-link-icon">&#10067;</span>Questions</a>
                <a href="#our-story" class="nav-link"><span class="nav-link-icon">&#128149;</span>Our Story</a>
            </div>
        </div>
    </nav>

    <!-- Quick nav for mobile (bottom bar) -->
    <nav class="quick-nav" id="quickNav">
        <a href="#rsvp" class="quick-nav-item" data-section="rsvp">
            <span class="quick-nav-icon">&#128140;</span>
            RSVP
        </a>
        <a href="#getting-there" class="quick-nav-item" data-section="getting-there">
            <span class="quick-nav-icon">&#9992;&#65039;</span>
            Travel
        </a>
        <a href="#accommodation" class="quick-nav-item" data-section="accommodation">
            <span class="quick-nav-icon">&#127968;</span>
            Stay
        </a>
        <a href="#faq" class="quick-nav-item" data-section="faq">
            <span class="quick-nav-icon">&#10067;</span>
            FAQ
        </a>
        <a href="#our-story" class="quick-nav-item" data-section="our-story">
            <span class="quick-nav-icon">&#128149;</span>
            Story
        </a>
    </nav>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <span class="lightbox-close">&times;</span>
        <div class="lightbox-content" id="lightboxContent"></div>
    </div>

    <!-- Sections are dynamically loaded here -->
    <div class="page-container" id="pageContainer">
        <div class="loading" style="text-align: center; padding: 4rem; font-family: system-ui;">Loading...</div>
    </div>

    <script>
        // ==========================================
        // SECTION LOADER
        // ==========================================
        const SECTIONS = [
            'rsvp',
            'getting-there',
            'accommodation',
            'faq',
            'our-story',
            'story',
            'funfacts',
            'game',
            'gallery',
            'dress',
            'weather',
            'playlist',
            'surprise',
            'confetti',
            'footer'
        ];

        async function loadSections() {
            const container = document.getElementById('pageContainer');
            container.innerHTML = '';

            for (const section of SECTIONS) {
                try {
                    const response = await fetch(`sections/${section}.html`);
                    if (response.ok) {
                        const html = await response.text();
                        container.insertAdjacentHTML('beforeend', html);
                    }
                } catch (e) {
                    console.warn(`Failed to load section: ${section}`, e);
                }
            }

            // Initialize all interactive features after sections are loaded
            initializeFeatures();
        }

        function initializeFeatures() {
            // ==========================================
            // VERSION & DEBUG
            // ==========================================
            const VERSION = 'v0.4.0';
            let DEBUG_MODE = false;

            const debugOverlay = document.getElementById('debugOverlay');
            const debugVersion = document.getElementById('debugVersion');
            const debugSection = document.getElementById('debugSection');
            const debugScroll = document.getElementById('debugScroll');
            const debugViewport = document.getElementById('debugViewport');
            const debugContainer = document.getElementById('debugContainer');
            const versionBadge = document.getElementById('versionBadge');
            const pageContainer = document.getElementById('pageContainer');

            debugVersion.textContent = VERSION;
            versionBadge.textContent = VERSION;

            function updateContainerWidth() {
                const aspectW = 9;
                const aspectH = 16;
                const vw = window.innerWidth;
                const vh = window.innerHeight;
                const mainWidth = Math.min(vw, vh * aspectW / aspectH);
                document.documentElement.style.setProperty('--main-width', mainWidth + 'px');
                if (DEBUG_MODE && debugContainer) {
                    debugContainer.textContent = Math.round(mainWidth) + 'px';
                }
            }

            function updateDebug() {
                if (!DEBUG_MODE) return;
                const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight) * 100).toFixed(1);
                debugScroll.textContent = scrollPercent + '%';
                debugViewport.textContent = window.innerWidth + 'x' + window.innerHeight;
                updateContainerWidth();
            }

            window.toggleDebug = function() {
                DEBUG_MODE = !DEBUG_MODE;
                debugOverlay.classList.toggle('visible', DEBUG_MODE);
                document.body.classList.toggle('debug-mode', DEBUG_MODE);
                if (DEBUG_MODE) updateDebug();
            };

            window.addEventListener('keydown', (e) => {
                if (e.key === 'd' || e.key === 'D') window.toggleDebug();
            });

            let tapCount = 0;
            let tapTimeout = null;
            document.addEventListener('touchend', (e) => {
                if (e.changedTouches.length !== 1) return;
                tapCount++;
                if (tapCount === 3) {
                    window.toggleDebug();
                    tapCount = 0;
                    clearTimeout(tapTimeout);
                } else {
                    clearTimeout(tapTimeout);
                    tapTimeout = setTimeout(() => { tapCount = 0; }, 400);
                }
            }, { passive: true });

            // ==========================================
            // COUNTDOWN TIMER
            // ==========================================
            const weddingDate = new Date('2026-08-29T16:00:00+10:00');

            function updateCountdown() {
                const now = new Date();
                const diff = weddingDate - now;
                const daysEl = document.getElementById('days');
                const hoursEl = document.getElementById('hours');
                const minutesEl = document.getElementById('minutes');
                const secondsEl = document.getElementById('seconds');

                if (!daysEl) return;

                if (diff <= 0) {
                    daysEl.textContent = '0';
                    hoursEl.textContent = '0';
                    minutesEl.textContent = '0';
                    secondsEl.textContent = '0';
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                daysEl.textContent = days;
                hoursEl.textContent = hours.toString().padStart(2, '0');
                minutesEl.textContent = minutes.toString().padStart(2, '0');
                secondsEl.textContent = seconds.toString().padStart(2, '0');
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);

            // ==========================================
            // SCROLL ANIMATIONS
            // ==========================================
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

            document.querySelectorAll('.fade-in, .timeline-item').forEach(el => {
                observer.observe(el);
            });

            // ==========================================
            // NAVIGATION
            // ==========================================
            const mainNav = document.getElementById('mainNav');
            const navToggle = document.getElementById('navToggle');
            const navMenu = document.getElementById('navMenu');
            const navLinks = document.querySelectorAll('.nav-link');
            const quickNavItems = document.querySelectorAll('.quick-nav-item');
            let isMenuOpen = false;

            navToggle.addEventListener('click', () => {
                isMenuOpen = !isMenuOpen;
                navToggle.classList.toggle('active', isMenuOpen);
                navMenu.classList.toggle('active', isMenuOpen);
                document.body.style.overflow = isMenuOpen ? 'hidden' : '';
            });

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (isMenuOpen) {
                        isMenuOpen = false;
                        navToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });

            window.addEventListener('scroll', () => {
                mainNav.classList.toggle('scrolled', window.scrollY > 50);
            }, { passive: true });

            // ==========================================
            // SECTION TRACKING
            // ==========================================
            const sections = document.querySelectorAll('.section[id]');
            const sectionMapping = {
                'rsvp': 'rsvp',
                'getting-there': 'getting-there',
                'accommodation': 'accommodation',
                'faq': 'faq',
                'our-story': 'our-story',
                'story': 'our-story',
                'funfacts': 'our-story',
                'game': 'our-story',
                'gallery': 'our-story',
                'dress': 'our-story',
                'weather': 'our-story',
                'playlist': 'our-story',
                'surprise': 'our-story',
                'confetti-section': 'our-story'
            };

            const sectionObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        const mappedSection = sectionMapping[id] || id;

                        if (DEBUG_MODE) debugSection.textContent = id;

                        navLinks.forEach(link => {
                            const href = link.getAttribute('href').slice(1);
                            link.classList.toggle('active', href === mappedSection);
                        });

                        quickNavItems.forEach(item => {
                            item.classList.toggle('active', item.dataset.section === mappedSection);
                        });
                    }
                });
            }, { threshold: 0.3 });

            sections.forEach(section => sectionObserver.observe(section));

            // ==========================================
            // FAQ ACCORDION
            // ==========================================
            document.querySelectorAll('.faq-question').forEach(btn => {
                btn.addEventListener('click', () => {
                    const item = btn.parentElement;
                    const isOpen = item.classList.contains('open');
                    document.querySelectorAll('.faq-item').forEach(i => i.classList.remove('open'));
                    if (!isOpen) item.classList.add('open');
                });
            });

            // ==========================================
            // WHO SAID IT GAME
            // ==========================================
            const gameQuote = document.getElementById('gameQuote');
            const gameOptions = document.getElementById('gameOptions');
            const gameScoreEl = document.getElementById('gameScore');
            const gameTotalEl = document.getElementById('gameTotal');
            const nextQuoteBtn = document.getElementById('nextQuote');

            if (gameQuote && gameOptions) {
                const quotes = [
                    { text: "I can't believe you actually ate that!", answer: "alina" },
                    { text: "Just five more minutes of sleep...", answer: "ben" },
                    { text: "We should get a dog... and name it Potato.", answer: "alina" },
                    { text: "Is it too early for pizza?", answer: "ben" },
                    { text: "I told you we should have turned left!", answer: "alina" },
                    { text: "Let's watch just ONE more episode.", answer: "ben" },
                ];

                let currentQuote = 0;
                let gameScore = 0;
                let gameTotal = 0;

                function loadQuote() {
                    if (currentQuote >= quotes.length) {
                        gameQuote.textContent = `Game Over! You got ${gameScore}/${gameTotal} correct!`;
                        gameOptions.style.display = 'none';
                        nextQuoteBtn.textContent = 'Play Again';
                        nextQuoteBtn.style.display = 'block';
                        nextQuoteBtn.onclick = () => {
                            currentQuote = 0;
                            gameScore = 0;
                            gameTotal = 0;
                            gameScoreEl.textContent = '0';
                            gameTotalEl.textContent = '0';
                            gameOptions.style.display = 'flex';
                            loadQuote();
                        };
                        return;
                    }

                    gameQuote.textContent = `"${quotes[currentQuote].text}"`;
                    gameOptions.querySelectorAll('.game-option').forEach(btn => {
                        btn.classList.remove('correct', 'wrong');
                        btn.disabled = false;
                    });
                    nextQuoteBtn.style.display = 'none';
                }

                gameOptions.querySelectorAll('.game-option').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const answer = btn.dataset.answer;
                        const correct = quotes[currentQuote].answer;

                        gameTotal++;
                        gameTotalEl.textContent = gameTotal;

                        if (answer === correct) {
                            btn.classList.add('correct');
                            gameScore++;
                            gameScoreEl.textContent = gameScore;
                        } else {
                            btn.classList.add('wrong');
                            gameOptions.querySelector(`[data-answer="${correct}"]`).classList.add('correct');
                        }

                        gameOptions.querySelectorAll('.game-option').forEach(b => b.disabled = true);
                        currentQuote++;
                        nextQuoteBtn.style.display = 'block';
                        nextQuoteBtn.onclick = loadQuote;
                    });
                });

                loadQuote();
            }

            // ==========================================
            // RSVP FORM
            // ==========================================
            const form = document.getElementById('rsvpForm');
            const conditionalFields = document.getElementById('conditionalFields');
            const attendingYes = document.getElementById('attending-yes');
            const attendingNo = document.getElementById('attending-no');
            const successMessage = document.getElementById('successMessage');

            if (form && attendingYes) {
                function updateConditionalFields() {
                    conditionalFields.classList.toggle('visible', attendingYes.checked);
                }

                attendingYes.addEventListener('change', updateConditionalFields);
                attendingNo.addEventListener('change', updateConditionalFields);

                form.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const googleFormURL = 'https://docs.google.com/forms/d/e/1FAIpQLSeEXUQYJv8zKuWFn1eND0zERz17sdyGkNXtflutpaCvvVouHQ/formResponse';
                    const isAttending = attendingYes.checked;

                    if (isAttending) {
                        let firstMissing = null;
                        const textFields = ['dietary', 'advice', 'funfact'];
                        for (const id of textFields) {
                            const el = document.getElementById(id);
                            if (!el.value.trim()) {
                                el.style.borderColor = '#f44336';
                                if (!firstMissing) firstMissing = el;
                            } else {
                                el.style.borderColor = '';
                            }
                        }
                        const taxiCheck = document.querySelector('input[name="taxi"]:checked');
                        document.querySelectorAll('input[name="taxi"] + label').forEach(l => {
                            l.style.borderColor = taxiCheck ? '' : '#f44336';
                        });
                        if (!taxiCheck && !firstMissing) {
                            firstMissing = document.getElementById('taxi-yes').parentElement;
                        }
                        if (firstMissing) {
                            firstMissing.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            if (firstMissing.focus) firstMissing.focus();
                            return;
                        }
                    }

                    const taxiSelection = document.querySelector('input[name="taxi"]:checked');

                    const formData = new URLSearchParams();
                    formData.append('entry.914100677', document.getElementById('name').value);
                    formData.append('entry.10330436', document.getElementById('email').value);
                    formData.append('entry.192864424', isAttending ? 'Yes' : 'No');
                    formData.append('entry.114598700', document.getElementById('guestnames').value);
                    formData.append('entry.392379933', document.getElementById('dietary').value);
                    formData.append('entry.975655166', taxiSelection ? taxiSelection.value : '');
                    formData.append('entry.878000076', document.getElementById('song').value);
                    formData.append('entry.1143246083', document.getElementById('advice').value);
                    formData.append('entry.1106183209', document.getElementById('funfact').value);
                    formData.append('entry.2119301072', document.getElementById('otherquestion').value);

                    fetch(googleFormURL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData.toString()
                    }).then(() => {
                        form.style.display = 'none';
                        successMessage.classList.add('visible');
                    }).catch(() => {
                        form.style.display = 'none';
                        successMessage.classList.add('visible');
                    });
                });
            }

            // ==========================================
            // SHAKE TO REVEAL
            // ==========================================
            const shakeReveal = document.getElementById('shakeReveal');
            if (shakeReveal) {
                let shakeThreshold = 15;
                let lastX = null, lastY = null, lastZ = null;

                if (window.DeviceMotionEvent) {
                    window.addEventListener('devicemotion', (e) => {
                        const acc = e.accelerationIncludingGravity;
                        if (!acc) return;

                        if (lastX !== null) {
                            const deltaX = Math.abs(acc.x - lastX);
                            const deltaY = Math.abs(acc.y - lastY);
                            const deltaZ = Math.abs(acc.z - lastZ);

                            if (deltaX + deltaY + deltaZ > shakeThreshold) {
                                shakeReveal.classList.add('revealed');
                            }
                        }

                        lastX = acc.x;
                        lastY = acc.y;
                        lastZ = acc.z;
                    });
                }

                shakeReveal.addEventListener('click', () => {
                    shakeReveal.classList.add('revealed');
                });
            }

            // ==========================================
            // CONFETTI
            // ==========================================
            const confettiBtn = document.getElementById('confettiBtn');
            const confettiArea = document.getElementById('confettiArea');

            if (confettiBtn && confettiArea) {
                function createConfetti() {
                    const colors = ['#cc5496', '#e87fb9', '#ffd700', '#87CEEB', '#ff6b6b', '#4CAF50'];

                    for (let i = 0; i < 50; i++) {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-10px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';

                        confettiArea.appendChild(confetti);

                        const animation = confetti.animate([
                            { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                            { transform: `translateY(${confettiArea.offsetHeight + 50}px) rotate(${720 + Math.random() * 360}deg)`, opacity: 0 }
                        ], {
                            duration: 2000 + Math.random() * 1000,
                            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                        });

                        animation.onfinish = () => confetti.remove();
                    }
                }

                confettiBtn.addEventListener('click', createConfetti);
            }

            // ==========================================
            // PARALLAX EFFECT
            // ==========================================
            const parallaxElements = document.querySelectorAll('.parallax-element');

            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                parallaxElements.forEach((el, i) => {
                    const speed = 0.1 + (i * 0.05);
                    el.style.transform = `translateY(${scrollY * speed}px)`;
                });

                if (DEBUG_MODE) updateDebug();
            }, { passive: true });

            // ==========================================
            // LIGHTBOX
            // ==========================================
            const lightbox = document.getElementById('lightbox');
            const lightboxContent = document.getElementById('lightboxContent');

            document.querySelectorAll('.gallery-item, .timeline-photo').forEach(item => {
                item.addEventListener('click', () => {
                    lightboxContent.innerHTML = `<p style="font-size: 1.2rem;">&#128247; Photo viewer coming soon!</p><p style="margin-top: 0.5rem; opacity: 0.7;">Click anywhere to close</p>`;
                    lightbox.classList.add('active');
                });
            });

            lightbox.addEventListener('click', () => {
                lightbox.classList.remove('active');
            });

            // ==========================================
            // RESIZE HANDLER
            // ==========================================
            window.addEventListener('resize', () => {
                updateContainerWidth();
                if (DEBUG_MODE) updateDebug();
            }, { passive: true });

            updateContainerWidth();
            updateDebug();
        }

        // Load sections when page is ready
        loadSections();
    </script>
</body>
</html>
